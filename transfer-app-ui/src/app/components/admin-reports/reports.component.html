<div class="reports">
  <div class="row mb-4">
    <div class="col-md-8">
      <h2>Transfer Reports & Analytics</h2>
      <p class="text-muted">Comprehensive overview of transfer applications, assignments, and statistics.</p>
    </div>
    <div class="col-md-4 text-end">
      <button class="btn btn-primary me-2" (click)="refreshReports()" [disabled]="loading">
        <i class="bi bi-arrow-clockwise me-1"></i>
        {{ loading ? 'Loading...' : 'Refresh' }}
      </button>
      <button class="btn btn-outline-success" (click)="exportToCSV()">
        <i class="bi bi-download me-1"></i>Export CSV
      </button>
    </div>
  </div>

  <!-- Statistics Overview -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h3 class="text-primary">{{ reports.statistics.totalDoctors || 0 }}</h3>
          <p class="card-text">Total Doctors</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h3 class="text-success">{{ reports.statistics.totalVacancies || 0 }}</h3>
          <p class="card-text">Total Vacancies</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h3 class="text-info">{{ reports.statistics.totalPositions || 0 }}</h3>
          <p class="card-text">Total Positions</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h3 class="text-warning">{{ reports.statistics.difficultStations || 0 }}</h3>
          <p class="card-text">Difficult Stations</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Assignment Summary -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Assignment Summary</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-4">
              <h4 class="text-success">{{ reports.assignmentSummary.assignedCount || 0 }}</h4>
              <small class="text-muted">Assigned</small>
            </div>
            <div class="col-4">
              <h4 class="text-warning">{{ reports.assignmentSummary.unassignedCount || 0 }}</h4>
              <small class="text-muted">Unassigned</small>
            </div>
            <div class="col-4">
              <h4 class="text-primary">{{ reports.assignmentSummary.assignmentRate || '0' }}%</h4>
              <small class="text-muted">Success Rate</small>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Additional Statistics</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <h4 class="text-info">{{ reports.statistics.totalCouples || 0 }}</h4>
              <small class="text-muted">Couple Applications</small>
            </div>
            <div class="col-6">
              <h4 class="text-secondary">{{ reports.statistics.averagePreferencesPerDoctor || '0' }}</h4>
              <small class="text-muted">Avg Preferences/Doctor</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Doctor Applications -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Doctor Applications & Assignments</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Merit Rank</th>
                  <th>Doctor Name</th>
                  <th>Preferences</th>
                  <th>Assigned Vacancy</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let app of reports.doctorApplications">
                  <td>
                    <span class="badge bg-primary">{{ app.doctor.meritRank }}</span>
                  </td>
                  <td>{{ app.doctor.fullName }}</td>
                  <td>
                    <span class="badge bg-info">{{ app.preferencesCount }}</span>
                  </td>
                  <td>
                    <span *ngIf="app.assignedVacancy" class="text-success">
                      {{ app.assignedVacancy.designation }} - {{ app.assignedVacancy.institution }}
                    </span>
                    <span *ngIf="!app.assignedVacancy" class="text-muted">Not assigned</span>
                  </td>
                  <td>
                    <span *ngIf="app.isAssigned" class="badge bg-success">Assigned</span>
                    <span *ngIf="!app.isAssigned" class="badge bg-warning">Unassigned</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Vacancy Applications -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Vacancy Applications & Popularity</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Vacancy</th>
                  <th>Institution</th>
                  <th>District</th>
                  <th>Positions</th>
                  <th>Preference Count</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let app of reports.vacancyApplications">
                  <td>
                    <strong>{{ app.vacancy.designation }}</strong>
                    <span *ngIf="app.vacancy.isDifficultStation" class="badge bg-warning ms-1">Difficult</span>
                  </td>
                  <td>{{ app.vacancy.institution }}</td>
                  <td>{{ app.vacancy.district }}</td>
                  <td>
                    <span class="badge bg-primary">{{ app.vacancy.count }}</span>
                  </td>
                  <td>
                    <span class="badge bg-info">{{ app.preferenceCount }}</span>
                  </td>
                  <td>
                    <span *ngIf="app.isFullyAssigned" class="badge bg-success">Fully Assigned</span>
                    <span *ngIf="!app.isFullyAssigned" class="badge bg-warning">Available</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Couple Applications -->
  <div class="row mb-4" *ngIf="reports.coupleApplications.length > 0">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Couple Applications</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Doctor 1</th>
                  <th>Doctor 2</th>
                  <th>Effective Merit Rank</th>
                  <th>Created</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let couple of reports.coupleApplications">
                  <td>
                    <span class="badge bg-primary me-1">{{ couple.doctor1.meritRank }}</span>
                    {{ couple.doctor1.fullName }}
                  </td>
                  <td>
                    <span class="badge bg-primary me-1">{{ couple.doctor2.meritRank }}</span>
                    {{ couple.doctor2.fullName }}
                  </td>
                  <td>
                    <span class="badge bg-warning">{{ couple.effectiveMeritRank }}</span>
                  </td>
                  <td>{{ couple.createdAt | date:'short' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading reports...</span>
    </div>
    <p class="mt-3 text-muted">Loading comprehensive reports...</p>
  </div>
</div>
